<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Portfolio</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  <nav class="navbar">
    <div class="logo">
      <img src="logo.png" alt="Logo">
      <span class="logo-text">My Portfolio</span>
    </div>

    <div class="nav-links">
      <a href="#home">Home</a>
      <a href="#about">About</a>
      <a href="#interest">Interests</a>
      <a href="#contact">Contact</a>
    </div>
  </nav>
</header>

<section id="home">
  <div class="home-text reveal">
    <h1>Hi, I‚Äôm Ashutosh</h1>
    <p>A creative web designer and developer who loves vibrant and functional interfaces.</p>
    <a href="cv.pdf" class="cv-btn"><i class="fas fa-download"></i> View CV</a>
  </div>

  <div class="home-image reveal">
    <img src="images.jpeg" alt="Profile">
  </div>
</section>

<section id="about">
  <div class="about-box reveal">
    <h2>About Me</h2>
    <p>I‚Äôm Ashutosh, a passionate learner who enjoys technology and creativity.</p>
  </div>

  <div class="about-box reveal">
    <h2>Skills</h2>
    <div class="skills-list">
      <div><i class="fab fa-html5"></i> HTML5</div>
      <div><i class="fas fa-gamepad"></i> Gaming</div>
    </div>
  </div>
</section>

<section id="interest">
  <h2 class="reveal">My Interests</h2>
  <div class="interest-cards">
    <div class="interest-card reveal">
      <img src="development.jpeg">
      <h3>Game Development</h3>
      <p>Creating immersive gameplay experiences.</p>
    </div>

    <div class="interest-card reveal">
      <img src="online.jpeg">
      <h3>Online Gaming</h3>
      <p>Exploring competitive digital games.</p>
    </div>

    <div class="interest-card reveal">
      <img src="animation.jpeg">
      <h3>Animation</h3>
      <p>Creative motion storytelling.</p>
    </div>
  </div>
</section>

<section id="contact">
  <div class="contact-form reveal">
    <h1>Contact Me</h1>
    <input type="text" placeholder="Your Name">
    <input type="email" placeholder="Your Email">
    <textarea rows="6" placeholder="Your Message"></textarea>
    <button>Send Message</button>
  </div>

  <div class="contact-info reveal">
    <h3>Get in Touch</h3>
    <p><i class="fas fa-envelope"></i> 25bcae12@kristujayanti.com</p>
    <p><i class="fab fa-instagram"></i> @ashu_boiii1233</p>
    <p><i class="fas fa-phone"></i> +91 87709 13466</p>
  </div>
</section>

<footer>
¬© 2026 Portfolio | Designed by Ashutosh Shukla
</footer>

<script>
  function reveal() {
    const reveals = document.querySelectorAll(".reveal");
    const windowHeight = window.innerHeight;
    const elementVisible = 120;

    reveals.forEach(el => {
      const elementTop = el.getBoundingClientRect().top;

      if (elementTop < windowHeight - elementVisible && elementTop > -el.offsetHeight) {
        el.classList.add("active");
      } else {
        el.classList.remove("active");
      }
    });
  }

  window.addEventListener("scroll", reveal);
  reveal();
</script>

<script type="module">
  // Firebase initialization + portfolio fetch + contact form logic
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  import { getFirestore, collection, addDoc, doc, getDoc, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBzR2J_ESj_GW2npsQg0JzQXCZWLEfea-U",
    authDomain: "ashutosh-portfolio-fe56b.firebaseapp.com",
    projectId: "ashutosh-portfolio-fe56b",
    storageBucket: "ashutosh-portfolio-fe56b.firebasestorage.app",
    messagingSenderId: "369756920882",
    appId: "1:369756920882:web:e32cb4fa85997cc475302b",
    measurementId: "G-TR3YN8VZEW"
  };

  const app = initializeApp(firebaseConfig);
  getAnalytics(app);
  const db = getFirestore(app);

  console.log("üî• Firebase connected");

  // Helper to render interests array into the DOM (preserve existing cards if present)
  function renderInterestsArray(interests) {
    const interestContainer = document.querySelector('.interest-cards');
    if (!interestContainer) return;
    const existingCards = interestContainer.querySelectorAll('.interest-card');
    if (existingCards.length > 0) {
      // Update existing cards' text/images
      const limit = Math.min(existingCards.length, interests.length);
      for (let i = 0; i < limit; i++) {
        const item = interests[i] || {};
        const card = existingCards[i];
        const imgEl = card.querySelector('img');
        const imgSrc = item.image || item.imageUrl || '';
        if (imgEl && imgSrc) imgEl.src = imgSrc;
        else if (!imgEl && imgSrc) card.insertAdjacentHTML('afterbegin', `<img src="${imgSrc}" alt="${(item.title||item.name||'')}">`);
        const h3 = card.querySelector('h3');
        const p = card.querySelector('p');
        if (h3 && (item.title || item.name)) h3.innerText = item.title || item.name;
        if (p && (item.description || item.desc)) p.innerText = item.description || item.desc;
      }
      if (interests.length > existingCards.length) {
        const extras = interests.slice(existingCards.length).map(item => {
          const title = typeof item === 'string' ? item : (item.title || item.name || '');
          const desc = item.description || item.desc || '';
          const img = item.image || item.imageUrl || '';
          return `
            <div class="interest-card reveal">
              ${img ? `<img src="${img}" alt="${title}">` : ''}
              <h3>${title}</h3>
              <p>${desc}</p>
            </div>
          `;
        }).join('');
        interestContainer.insertAdjacentHTML('beforeend', extras);
      }
    } else {
      // No existing cards ‚Äî render fresh
      interestContainer.innerHTML = interests.map(item => {
        const title = typeof item === 'string' ? item : (item.title || item.name || '');
        const desc = item.description || item.desc || '';
        const img = item.image || item.imageUrl || '';
        return `
          <div class="interest-card reveal">
            ${img ? `<img src="${img}" alt="${title}">` : ''}
            <h3>${title}</h3>
            <p>${desc}</p>
          </div>
        `;
      }).join('');
    }
    if (typeof reveal === 'function') reveal();
  }

  // Real-time listener: updates when documents in `interest` collection change
  try {
    // listen to the specific document `interest/interest-dtls` (user-provided)
    const interestDocRef = doc(db, 'interest', 'interest-dtls');
    onSnapshot(interestDocRef, snap => {
      if (!snap.exists()) {
        console.log('‚ÑπÔ∏è interest-dtls document not found');
        return;
      }
      const data = snap.data() || {};

      // Normalize to an array of items
      let items = null;
      if (Array.isArray(data.interests) && data.interests.length) items = data.interests.slice();
      else if (Array.isArray(data.items) && data.items.length) items = data.items.slice();
      else if (Array.isArray(data.list) && data.list.length) items = data.list.slice();
      else {
        // handle numbered keys like {"0": {...}, "1": {...}}
        const numericKeys = Object.keys(data).filter(k => String(Number(k)) === k).sort((a,b)=>a-b);
        if (numericKeys.length) items = numericKeys.map(k => data[k]);
        else if (Object.keys(data).length) {
          // fallback: treat the whole doc as a single item
          items = [data];
        } else items = [];
      }

      if (!items || items.length === 0) {
        console.log('‚ö†Ô∏è interest-dtls has no interest items to render');
        return;
      }

      console.log('üîÅ interest-dtls snapshot:', items);
      renderInterestsArray(items);
    }, err => {
      console.error('‚ùå interest-dtls snapshot error:', err);
    });
  } catch (e) {
    console.warn('‚ö†Ô∏è could not attach onSnapshot listener (check rules/auth):', e);
  }

  // ================= FETCH PORTFOLIO DATA =================
  async function loadPortfolioData() {
    try {
      const docRef = doc(db, "portfolio", "portfolio-dtls");
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        console.log("‚ùå Portfolio document not found");
        return;
      }

      const data = docSnap.data();
      console.log("üì¶ Portfolio data:", data);

      const homeH1 = document.querySelector("#home h1");
      const homeP = document.querySelector("#home p");
      const aboutP = document.querySelector("#about p");
      const contactPs = document.querySelectorAll(".contact-info p");
      const interestContainer = document.querySelector(".interest-cards");

      if (data.name && homeH1) homeH1.innerText = data.name;
      if (data.role && homeP) homeP.innerText = data.role;
      if ((data.about || data.description) && aboutP) aboutP.innerText = data.about || data.description;

      if (contactPs.length > 0) {
        if (data.email && contactPs[0]) contactPs[0].innerHTML = `<i class="fas fa-envelope"></i> ${data.email}`;
        if (data.phoneno && contactPs[2]) contactPs[2].innerHTML = `<i class="fas fa-phone"></i> ${data.phoneno}`;
      }

      // ================= POPULATE INTERESTS =================
      // First try interests inside the main document
      let interests = Array.isArray(data.interests) && data.interests.length ? data.interests.slice() : null;

      // If not present, fetch interest document `interest/interest-dtls`
      if ((!interests || interests.length === 0) && db) {
        try {
          const interestDocRef = doc(db, 'interest', 'interest-dtls');
          const interestSnap = await getDoc(interestDocRef);
          if (interestSnap.exists()) {
            const val = interestSnap.data() || {};
            // prefer common array fields
            if (Array.isArray(val.interests) && val.interests.length) {
              interests = val.interests.slice();
            } else if (Array.isArray(val.items) && val.items.length) {
              interests = val.items.slice();
            } else if (Array.isArray(val.list) && val.list.length) {
              interests = val.list.slice();
            } else {
              // if doc stores numbered keys, convert to array
              const numericKeys = Object.keys(val).filter(k => String(Number(k)) === k).sort((a,b)=>a-b);
              if (numericKeys.length) {
                interests = numericKeys.map(k => val[k]);
              } else if (Array.isArray(val)) {
                interests = val.slice();
              } else {
                // as a last resort, convert object values to array
                interests = Object.values(val);
              }
            }

            if (interests && interests.length) console.log('‚ÑπÔ∏è loaded interests from `interest/interest-dtls`:', interests);
          } else {
            console.log('‚ÑπÔ∏è interest-dtls document not found');
          }
        } catch (e) {
          console.error('‚ùå Failed to fetch interest/interest-dtls:', e);
        }
      }

      // Normalize if still an object/map
      if (interests && !Array.isArray(interests) && typeof interests === 'object') {
        interests = Object.values(interests);
      }

      // If interests missing, use fallback
      if (!Array.isArray(interests) || interests.length === 0) {
        interests = [
          { title: 'Game Development', description: 'Creating immersive gameplay experiences.' },
          { title: 'Online Gaming', description: 'Exploring competitive digital games.' },
          { title: 'Animation', description: 'Creative motion storytelling.' }
        ];
        console.log('‚ö†Ô∏è using fallback interests:', interests);
      }

      // Render interest cards: update existing cards (preserve images) or create new ones
      if (interestContainer) {
        const existingCards = interestContainer.querySelectorAll('.interest-card');
        if (existingCards.length > 0) {
          const limit = Math.min(existingCards.length, interests.length);
          for (let i = 0; i < limit; i++) {
            const item = interests[i] || {};
            const card = existingCards[i];

            // update image if provided, otherwise keep existing
            const imgEl = card.querySelector('img');
            const imgSrc = item.image || item.imageUrl || '';
            if (imgEl && imgSrc) imgEl.src = imgSrc;
            else if (!imgEl && imgSrc) card.insertAdjacentHTML('afterbegin', `<img src="${imgSrc}" alt="${(item.title||item.name||'')}">`);

            // update title/description only if provided
            const h3 = card.querySelector('h3');
            const p = card.querySelector('p');
            if (h3 && (item.title || item.name)) h3.innerText = item.title || item.name;
            if (p && (item.description || item.desc)) p.innerText = item.description || item.desc;
          }

          // append extras if more interests than existing cards
          if (interests.length > existingCards.length) {
            const extras = interests.slice(existingCards.length).map(item => {
              const title = typeof item === 'string' ? item : (item.title || item.name || '');
              const desc = item.description || item.desc || '';
              const img = item.image || item.imageUrl || '';
              return `
                <div class="interest-card reveal">
                  ${img ? `<img src="${img}" alt="${title}">` : ''}
                  <h3>${title}</h3>
                  <p>${desc}</p>
                </div>
              `;
            }).join('');
            interestContainer.insertAdjacentHTML('beforeend', extras);
          }

        } else {
          // No existing cards ‚Äî create simple cards from interests
          interestContainer.innerHTML = interests.map(item => {
            const title = typeof item === 'string' ? item : (item.title || item.name || '');
            const desc = item.description || item.desc || '';
            const img = item.image || item.imageUrl || '';
            return `
              <div class="interest-card reveal">
                ${img ? `<img src="${img}" alt="${title}">` : ''}
                <h3>${title}</h3>
                <p>${desc}</p>
              </div>
            `;
          }).join('');
        }

        if (typeof reveal === 'function') reveal();
      } else {
        console.log('‚ö†Ô∏è interest container not found in DOM');
      }

    } catch (error) {
      console.error("‚ùå Error fetching portfolio data:", error);
    }
  }

  // load portfolio data immediately
  loadPortfolioData();

  // ============ CONTACT FORM LOGIC ============
  const contactSection = document.querySelector("#contact");

  const nameInput = contactSection.querySelector("input[type='text']");
  const emailInput = contactSection.querySelector("input[type='email']");
  const messageInput = contactSection.querySelector("textarea");
  const sendButton = contactSection.querySelector("button");

  sendButton.addEventListener("click", async () => {

    // 1Ô∏è‚É£ Get values
    const name = nameInput.value.trim();
    const email = emailInput.value.trim();
    const message = messageInput.value.trim();

    // 2Ô∏è‚É£ Validate
    if (!name || !email || !message) {
      alert("Please fill all fields ‚ùó");
      return;
    }

    try {
      await addDoc(collection(db, "messages"), {
        name: name,
        email: email,
        message: message,
        createdAt: new Date()
      });

      alert("Message sent successfully ‚úÖ");

      // 4Ô∏è‚É£ Clear form
      nameInput.value = "";
      emailInput.value = "";
      messageInput.value = "";

    } catch (error) {
      console.error("Error saving message:", error);
      alert("Failed to send message ‚ùå");
    }
  });
</script>

</body>
</html>
